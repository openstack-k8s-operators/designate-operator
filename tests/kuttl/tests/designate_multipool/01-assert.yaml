apiVersion: designate.openstack.org/v1beta1
kind: Designate
metadata:
  name: designate
spec:
  databaseInstance: openstack
  databaseAccount: designate
  serviceUser: designate
  secret: osp-secret
  preserveJobs: false
  designateAPI:
    replicas: 1
  designateCentral:
    replicas: 1
  designateWorker:
    replicas: 1
  designateProducer:
    replicas: 1
  designateUnbound:
    replicas: 1
  customServiceConfig: |
    [DEFAULT]
    debug = true
status:
  designateAPIReadyCount: 1
  designateBackendbind9ReadyCount: 2
  designateCentralReadyCount: 1
  designateMdnsReadyCount: 1
  designateProducerReadyCount: 1
  designateUnboundReadyCount: 1
  designateWorkerReadyCount: 1
  databaseHostname: openstack.designate-kuttl-tests.svc
  conditions:
  - message: Setup complete
    reason: Ready
    status: "True"
    type: Ready
  - message: DB create completed
    reason: Ready
    status: "True"
    type: DBReady
  - message: DBsync completed
    reason: Ready
    status: "True"
    type: DBSyncReady
  - message: Setup complete
    reason: Ready
    status: "True"
    type: DesignateAPIReady
  - message: Setup complete
    reason: Ready
    status: "True"
    type: DesignateBackendbind9Ready
  - message: Setup complete
    reason: Ready
    status: "True"
    type: DesignateCentralReady
  - message: Setup complete
    reason: Ready
    status: "True"
    type: DesignateMdnsReady
  - message: Setup complete
    reason: Ready
    status: "True"
    type: DesignateProducerReady
  - message: Setup complete
    reason: Ready
    status: "True"
    type: DesignateUnboundReady
  - message: Setup complete
    reason: Ready
    status: "True"
    type: DesignateWorkerReady
  - message: Input data complete
    reason: Ready
    status: "True"
    type: InputReady
  - message: MariaDBAccount creation complete
    reason: Ready
    status: "True"
    type: MariaDBAccountReady
  - message: RabbitMqTransportURL successfully created
    reason: Ready
    status: "True"
    type: RabbitMqTransportURLReady
  - message: RoleBinding created
    reason: Ready
    status: "True"
    type: RoleBindingReady
  - message: Role created
    reason: Ready
    status: "True"
    type: RoleReady
  - message: ServiceAccount created
    reason: Ready
    status: "True"
    type: ServiceAccountReady
  - message: Service config create completed
    reason: Ready
    status: "True"
    type: ServiceConfigReady
---
# Verify that 2 StatefulSets are created for the 2 pools
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: designate-backendbind9-pool0
  labels:
    pool: default
    pool-index: "0"
status:
  readyReplicas: 1
---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: designate-backendbind9-pool1
  labels:
    pool: pool1
    pool-index: "1"
status:
  readyReplicas: 1
---
# Verify pool-specific services are created
apiVersion: v1
kind: Service
metadata:
  name: designate-backendbind9-pool0-0
---
apiVersion: v1
kind: Service
metadata:
  name: designate-backendbind9-pool1-0
---
# Verify per-pool bind IP ConfigMaps are created with RNDC key mappings
apiVersion: v1
kind: ConfigMap
metadata:
  name: designate-bind-ip-map
data:
  bind_address_0: ""  # Will be filled by predictable IP controller
  rndc_key_0: rndc-key-0
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: designate-bind-ip-map-pool1
data:
  bind_address_0: ""  # Will be filled by predictable IP controller
  rndc_key_0: rndc-key-1
---
# Verify TSIG secret is created for non-default pools
apiVersion: v1
kind: Secret
metadata:
  name: designate-backendbind9-tsig
  labels:
    service: designate-backendbind9
    component: designate-backendbind9
type: Opaque
