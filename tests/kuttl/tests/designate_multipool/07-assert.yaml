# Verify pool0 StatefulSet exists (reuses single-pool name for backwards compatibility)
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: designate-backendbind9
  labels:
    pool: default
    pool-index: "0"
status:
  readyReplicas: 1
---
# Verify pool1 StatefulSet exists
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: designate-backendbind9-pool1
  labels:
    pool: pool1
    pool-index: "1"
status:
  readyReplicas: 1
---
# Verify single-pool StatefulSet was preserved and converted to pool0
apiVersion: kuttl.dev/v1beta1
kind: TestAssert
commands:
  - script: |
      # Verify the single-pool StatefulSet (designate-backendbind9) now has pool labels
      if ! oc get statefulset designate-backendbind9 -n $NAMESPACE -o jsonpath='{.metadata.labels.pool}' 2>/dev/null | grep -q "default"; then
        echo "ERROR: Single-pool StatefulSet should be preserved and have pool=default label"
        exit 1
      fi
      if ! oc get statefulset designate-backendbind9 -n $NAMESPACE -o jsonpath='{.metadata.labels.pool-index}' 2>/dev/null | grep -q "0"; then
        echo "ERROR: Single-pool StatefulSet should have pool-index=0 label"
        exit 1
      fi
      echo "SUCCESS: Migrated back to multipool mode (pool0 reused single-pool StatefulSet)"
---
apiVersion: designate.openstack.org/v1beta1
kind: Designate
metadata:
  name: designate
status:
  designateBackendbind9ReadyCount: 2  # 2 pools Ã— 1 replica each
  conditions:
  - message: Setup complete
    reason: Ready
    status: "True"
    type: Ready
